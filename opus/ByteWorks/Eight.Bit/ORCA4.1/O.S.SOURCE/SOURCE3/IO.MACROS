 MACRO&LAB DBNE &R,&BP AIF '&R'='X',.L1 AIF '&R'='Y',.L1&LAB DEC &R BNE &BP MEXIT.L1&LAB DE&R BNE &BP MEND MACRO&LAB DBPL &R,&BP AIF '&R'='X',.L1 AIF '&R'='Y',.L1&LAB DEC &R BPL &BP MEXIT.L1&LAB DE&R BPL &BP MEND MACRO&LAB ADD2 &N1,&N2,&N3&LAB ANOP LCLB &IM1 LCLB &IM2 LCLB &IN1 LCLB &IN2 LCLB &IN3 LCLB &IN LCLB &ST1 LCLB &ST2 LCLB &ST3 LCLC &C LCLC &N12 LCLC &N22 LCLC &N32 AIF '&N1'<>'*',.A&IN1 SETB 1&IN SETB 1&ST1 SETB 1&N1 SETC '(SYSESTE),Y'&N12 SETC '(SYSESTE),Y' AGO .D.A&C AMID &N1,1,1 AIF '&C'<>'#',.B&IM1 SETB 1&N12 AMID &N1,2,L:&N1-1&N12 SETC #>&N12 AGO .D.B AIF '&C'<>'{',.C&IN1 SETB 1&IN SETB 1&C AMID &N1,L:&N1,1 AIF '&C'<>'}',.Y&N1 AMID &N1,2,L:&N1-2&N12 SETC '(&N1),Y'&N1 SETC '(&N1),Y' AGO .D.C&N12 SETC &N1+1.D AIF '&N2'<>'*',.E&IN2 SETB 1&IN SETB 1&ST2 SETB 1&N2 SETC '(SYSESTE),Y'&N22 SETC '(SYSESTE),Y' AGO .H.E&C AMID &N2,1,1 AIF '&C'<>'#',.F&IM2 SETB 1&N22 AMID &N2,2,L:&N2-1&N22 SETC #>&N22 AGO .H.F AIF '&C'<>'{',.G&IN2 SETB 1&IN SETB 1&C AMID &N2,L:&N2,1 AIF '&C'<>'}',.Y&N2 AMID &N2,2,L:&N2-2&N22 SETC '(&N2),Y'&N2 SETC '(&N2),Y' AGO .H.G&N22 SETC &N2+1.H AIF C:&N3>0,.I AIF .NOT.&IM2..OR.&IN,.H1&C AMID &N2,2,L:&N2-1 AIF &C<256,.V.H1 LCLC &N3&N3 SETC '&N1'&N32 SETC '&N12'&IN3 SETB &IN1&ST3 SETB &ST1 AIF .NOT.&IM1,.L MNOTE 'Must specify destination',16 MEXIT.I AIF '&N3'<>'*',.J&IN3 SETB 1&IN SETB 1&ST3 SETB 1&N3 SETC '(SYSESTE),Y'&N32 SETC '(SYSESTE),Y' AGO .L.J&C AMID &N3,1,1 AIF '&C'<>'{',.K&IN3 SETB 1&IN SETB 1&C AMID &N3,L:&N3,1 AIF '&C'<>'}',.Y&N3 AMID &N3,2,L:&N3-2&N32 SETC '(&N3),Y'&N3 SETC '(&N3),Y' AGO .L.K&N32 SETC &N3+1.L AIF &ST1..AND.&ST2,.Q AIF &ST1+&ST2>=&ST3,.M SEC LDA SYSESTE SBC #2 STA SYSESTE BCS SYSA&SYSCNT DEC SYSESTE+1SYSA&SYSCNT ANOP.M CLC AIF .NOT.&IN,.N LDY #0.N LDA &N1 ADC &N2 STA &N3 AIF .NOT.&IN,.O INY.O LDA &N12 ADC &N22 STA &N32 AIF &ST1+&ST2<=&ST3,.P CLC LDA SYSESTE ADC #2 STA SYSESTE BCC SYSB&SYSCNT INC SYSESTE+1SYSB&SYSCNT ANOP.P MEXIT.Q AIF &IN3..AND..NOT.&ST3,.R CLC LDY #0 LDA &N1 LDY #2 ADC &N2 STA &N3 DEY LDA &N12 LDY #3 ADC &N22 STA &N32 AGO .S.R CLC LDY #0 LDA &N1 LDY #2 ADC &N2 LDY #0 STA &N3 INY LDA &N12 LDY #3 ADC &N22 LDY #1 STA &N32.S CLC LDA SYSESTE AIF &ST3,.T ADC #4 AGO .U.T ADC #2.U STA SYSESTE BCC SYSC&SYSCNT INC SYSESTE+1SYSC&SYSCNT ANOP MEXIT.V CLC AIF .NOT.&IN,.W LDY #0.W LDA &N1 ADC &N2 STA &N1 BCC SYSD&SYSCNT AIF .NOT.&IN,.X INY.X INC &N1+1SYSD&SYSCNT ANOP MEXIT.Y MNOTE 'Missing closing ''}''',16 MEND MACRO&LAB LA &AD1,&AD2,&R LCLA &LP LCLC &A&A SETC A AIF C:&R=0,.C1&A SETC &R.C1&LAB LD&A #<&AD2&LP SETA C:&AD1.C2 ST&A &AD1(&LP)&LP SETA &LP-1 AIF &LP>0,.C2 AIF &AD2=0,.C2A LD&A #>&AD2.C2A&LP SETA C:&AD1.C3 ST&A &AD1(&LP).+1&LP SETA &LP-1 AIF &LP>0,.C3 MEND MACRO&LAB LM &AD1,&AD2,&R LCLC &A LCLA &LP&A SETC A AIF C:&R=0,.LB1&A SETC &R.LB1&LAB LD&A &AD2&LP SETA C:&AD1.LB2 ST&A &AD1(&LP)&LP SETA &LP-1 AIF &LP<>0,.LB2 MEND MACRO&LAB INC2 &N1 LCLC &C LCLC &C1 LCLC &B1 AIF '&N1'<>'*',.A&N1 SETC SYSESTE AGO .A1.A&C AMID &N1,1,1 AIF '&C'<>'{',.B&C AMID &N1,L:&N1,1 AIF '&C'<>'}',.C&N1 AMID &N1,2,L:&N1-2.A1&LAB LDY #0 CLC LDA (&N1),Y ADC #1 STA (&N1),Y INY LDA (&N1),Y ADC #0 STA (&N1),Y MEXIT.B&LAB INC &N1 BNE SYSI&SYSCNT INC &N1+1SYSI&SYSCNT ANOP MEXIT.C MNOTE 'Missing closing ''}''',16 MEND MACRO&LAB MLSR &ADR,&NUM&LAB ANOP LCLA &NM&NM SETA &NUM.TOP LSR &ADR&NM SETA &NM-1 AIF &NM>0,.TOP MEND MACRO&LAB JNE &BP&LAB BEQ SA&SYSCNT JMP &BPSA&SYSCNT ANOP MEND MACRO&LAB MOVE &AD1,&AD2,&LEN&LAB ANOP LCLB &IN LCLB &ST1 LCLB &ST2 LCLB &IM1 LCLC &C AIF "&AD1"<>"*",.A&ST1 SETB 1&AD1 SETC (SYSESTE)&IN SETB 1 AGO .C.A&C AMID &AD1,1,1 AIF "&C"<>"#",.B&IM1 SETB 1 AGO .C.B AIF "&C"<>"{",.C&C AMID &AD1,L:&AD1,1 AIF "&C"<>"}",.X&C AMID &AD1,2,L:&AD1-2&AD1 SETC (&C)&IN SETB 1.C AIF "&AD2"<>"*",.D&ST2 SETB 1&AD2 SETC (SYSESTE)&IN SETB 1 AGO .E.D&C AMID &AD2,1,1 AIF "&C"<>"{",.E&C AMID &AD2,L:&AD2,1 AIF "&C"<>"}",.X&C AMID &AD2,2,L:&AD2-2&AD2 SETC (&C)&IN SETB 1.E AIF &IN,.I AIF C:&LEN=0,.G AIF &IM1,.F LDX &LENSYSA&SYSCNT LDA &AD1-1,X STA &AD2-1,X DEX BNE SYSA&SYSCNT MEXIT.F LDX &LEN LDA &AD1SYSA&SYSCNT STA &AD2-1,X DEX BNE SYSA&SYSCNT MEXIT.G AIF &IM1,.H LDA &AD1 STA &AD2 LDA &AD1+1 STA &AD2+1 MEXIT.H LDA &AD1 STA &AD2 STA &AD2+1 MEXIT.I AIF .NOT.&ST2,.K AIF C:&LEN=0,.J LDA &LEN JSR SYSISTK AGO .K.J LDA #2 JSR SYSISTK.K AIF C:&LEN=0,.N&C AMID &LEN,1,1 AIF "&C"<>"#",.M&C AMID &LEN,2,L:&LEN-1 AIF &C=1,.L AIF &C>129,.K1 LDY &LEN-1SYSA&SYSCNT LDA &AD1,Y STA &AD2,Y DEY BPL SYSA&SYSCNT AGO .O.K1 LDY &LEN-1SYSA&SYSCNT LDA &AD1,Y STA &AD2,Y DEY BNE SYSA&SYSCNT LDA &AD1,Y STA &AD2,Y AGO .O.L LDY #0 LDA &AD1,Y STA &AD2,Y AGO .O.M LDY &LEN DEY BEQ SYSB&SYSCNTSYSA&SYSCNT LDA &AD1,Y STA &AD2,Y DEY BNE SYSA&SYSCNTSYSB&SYSCNT LDA &AD1,Y STA &AD2,Y AGO .O.N LDY #0 LDA &AD1,Y STA &AD2,Y INY LDA &AD1,Y STA &AD2,Y.O AIF .NOT.&ST1,.Q AIF C:&LEN=0,.P LDA &LEN JSR SYSDSTK MEXIT.P LDA #2 JSR SYSDSTK.Q MEXIT.X MNOTE "Missing '}'",16 MEND MACRO&LAB GOTOXY &X,&Y&LAB LDA #$1E JSR SYSCOUT CLC LDA &X ADC #32 JSR SYSCOUT CLC LDA &Y ADC #32 JSR SYSCOUT MEND MACRO&LAB SUB2 &N1,&N2,&N3&LAB ANOP LCLB &IM1 LCLB &IM2 LCLB &IN1 LCLB &IN2 LCLB &IN3 LCLB &IN LCLB &ST1 LCLB &ST2 LCLB &ST3 LCLC &C LCLC &N12 LCLC &N22 LCLC &N32 AIF '&N1'<>'*',.A&IN1 SETB 1&IN SETB 1&ST1 SETB 1&N1 SETC '(SYSESTE),Y'&N12 SETC '(SYSESTE),Y' AGO .D.A&C AMID &N1,1,1 AIF '&C'<>'#',.B&IM1 SETB 1&N12 AMID &N1,2,L:&N1-1&N12 SETC #>&N12 AGO .D.B AIF '&C'<>'{',.C&IN1 SETB 1&IN SETB 1&C AMID &N1,L:&N1,1 AIF '&C'<>'}',.Y&N1 AMID &N1,2,L:&N1-2&N12 SETC '(&N1),Y'&N1 SETC '(&N1),Y' AGO .D.C&N12 SETC &N1+1.D AIF '&N2'<>'*',.E&IN2 SETB 1&IN SETB 1&ST2 SETB 1&N2 SETC '(SYSESTE),Y'&N22 SETC '(SYSESTE),Y' AGO .H.E&C AMID &N2,1,1 AIF '&C'<>'#',.F&IM2 SETB 1&N22 AMID &N2,2,L:&N2-1&N22 SETC #>&N22 AGO .H.F AIF '&C'<>'{',.G&IN2 SETB 1&IN SETB 1&C AMID &N2,L:&N2,1 AIF '&C'<>'}',.Y&N2 AMID &N2,2,L:&N2-2&N22 SETC '(&N2),Y'&N2 SETC '(&N2),Y' AGO .H.G&N22 SETC &N2+1.H AIF C:&N3>0,.I AIF .NOT.&IM2..OR.&IN,.H1&C AMID &N2,2,L:&N2-1 AIF &C<256,.V.H1 LCLC &N3&N3 SETC '&N1'&N32 SETC '&N12'&IN3 SETB &IN1&ST3 SETB &ST1 AIF .NOT.&IM1,.L MNOTE 'Must specify destination',16 MEXIT.I AIF '&N3'<>'*',.J&IN3 SETB 1&IN SETB 1&ST3 SETB 1&N3 SETC '(SYSESTE),Y'&N32 SETC '(SYSESTE),Y' AGO .L.J&C AMID &N3,1,1 AIF '&C'<>'{',.K&IN3 SETB 1&IN SETB 1&C AMID &N3,L:&N3,1 AIF '&C'<>'}',.Y&N3 AMID &N3,2,L:&N3-2&N32 SETC '(&N3),Y'&N3 SETC '(&N3),Y' AGO .L.K&N32 SETC &N3+1.L AIF &ST1..AND.&ST2,.Q AIF &ST1+&ST2>=&ST3,.M SEC LDA SYSESTE SBC #2 STA SYSESTE BCS SYSA&SYSCNT DEC SYSESTE+1SYSA&SYSCNT ANOP.M SEC AIF .NOT.&IN,.N LDY #0.N LDA &N1 SBC &N2 STA &N3 AIF .NOT.&IN,.O INY.O LDA &N12 SBC &N22 STA &N32 AIF &ST1+&ST2<=&ST3,.P CLC LDA SYSESTE ADC #2 STA SYSESTE BCC SYSB&SYSCNT INC SYSESTE+1SYSB&SYSCNT ANOP.P MEXIT.Q AIF .NOT.&ST3,.R SEC LDY #2 LDA &N1 LDY #0 SBC &N2 LDY #2 STA &N3 INY LDA &N12 LDY #1 SBC &N22 LDY #3 STA &N32 AGO .S.R SEC LDY #2 LDA &N1 LDY #0 SBC &N2 STA &N3 LDY #3 LDA &N12 LDY #1 SBC &N22 STA &N32.S CLC LDA SYSESTE AIF &ST3,.T ADC #4 AGO .U.T ADC #2.U STA SYSESTE BCC SYSC&SYSCNT INC SYSESTE+1SYSC&SYSCNT ANOP MEXIT.V SEC AIF .NOT.&IN,.W LDY #0.W LDA &N1 SBC &N2 STA &N1 BCS SYSD&SYSCNT AIF .NOT.&IN,.X INY.X DEC &N1+1SYSD&SYSCNT ANOP MEXIT.Y MNOTE 'Missing closing ''}''',16 MEND MACRO&LAB ERROR &ERR&LAB LDX &ERR JSR SYSEROR MEND MACRO&LAB DEC2 &N1 LCLC &C LCLC &C1 LCLC &B1 AIF '&N1'<>'*',.A&N1 SETC SYSESTE AGO .A1.A&C AMID &N1,1,1 AIF '&C'<>'{',.B&C AMID &N1,L:&N1,1 AIF '&C'<>'}',.C&N1 AMID &N1,2,L:&N1-2.A1&LAB LDY #0 SEC LDA (&N1),Y SBC #1 STA (&N1),Y INY LDA (&N1),Y SBC #0 STA (&N1),Y MEXIT.B&LAB LDA &N1 BNE SYSI&SYSCNT DEC &N1+1SYSI&SYSCNT DEC &N1 MEXIT.C MNOTE 'Missing closing ''}''',16 MEND MACRO&LAB BELL&LAB LDA #$07 JSR SYSCOUT MEND MACRO&LAB JEQ &BP&LAB BNE *+5 JMP &BP MEND MACRO&LAB JPL &BP&LAB BMI *+5 JMP &BP MEND