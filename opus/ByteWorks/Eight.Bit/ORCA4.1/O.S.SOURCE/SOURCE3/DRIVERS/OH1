         LIST OFF         SYMBOL OFF         ORG   $800         MCOPY /RAM/OH.MACROS         KEEP  ORCA.VID1         TITLE 'ORCA/HOST V4.1 ** CONFIDENTIAL **'******************************************************************  ORCA/HOST V4.1**  This is the operating system shell for ORCA HOST 4.1.  It*  sits between ProDOS and the ORCA language development*  system, providing a standardized hardware independent*  environment for ORCA language products and application*  programs.**  By Mike Westerfield and Phil Montoya**  This source code is a trade secret of The Byte Works, Inc.,*  and cannot be copied or used in any way without the written*  permission of that company.**  Object Module Copyright 1985*  By The Byte Works, Inc.*  All rights reserved.*****************************************************************         EJECT******************************************************************  SACOMM - Common Area for Overlay Processor******************************************************************SACOMM   DATA;;  Zero page variables.;TYPE80   GEQU  1                        Conditional Assembly Flag for CRT driver;                                        0 = APPLE 80;                                        1 = VIDEX STANDARD AND ULTRATERM;                                        2 = VIDEX NO INVERSE;                                        3 = 40 COL DRIVERLINADR   GEQU  $2                       line addressCH       GEQU  $24                      horizontal cursorCV       GEQU  $25                      vertical cursorR0       GEQU  $80                      general purpose registersR1       GEQU  $81R2       GEQU  $82R3       GEQU  $83R4       GEQU  $84R5       GEQU  $85R6       GEQU  $86R7       GEQU  $87HOOKOUT  GEQU  $36                      character output vectorHOOKIN   GEQU  $38                      character input vectorWR0      GEQU  $C0                      working registersWR1      GEQU  $C1WR2      GEQU  $C2WR3      GEQU  $C3WR4      GEQU  $C4WR5      GEQU  $C5MR0      GEQU  $C8STR      GEQU  $ECSYSS1    GEQU  $D0                      math registersSYSS2    GEQU  $E1SYSOUT   GEQU  $F2SYSESTE  GEQU  $98SYSFERR  GEQU  $EBOSTR     GEQU  $F4                      location counterProHOOK  GEQU  $FA                      ProDOS/SOS call hookORCAHOOK GEQU  $FD                      ORCA call hook;;  Constants;FALSE    GEQU  0                        boolean constantsTRUE     GEQU  1ProDOS   GEQU  TRUE                     use ProDOS entry methods;;  Fixed memory definitions;BREAK    EQU   $3F0                     Break VectorLOMEM    EQU   $2000                    Lomem AddressBITMAP   EQU   $BF58                    ProDOS memory use bit mapLEVEL    EQU   $BF94                    ProDOS file level indicator;;  Entry points for the system initialization routine.;         DC    A'SAREST'         DC    A'SAINIT'                initialization routine         DC    A'PAMAIN'                main control;;  Addresses for Sysgen;         DC    A'CLICK'                 keyboard click flag         DC    A'WAITF'                 pause/wait flag         DC    A'CURLANG'               current language         DC    A'PRINTER'               printer enabled flag         DC    A'UPREFIX'               utility prefix table (address to prefix;                                        table)         DC    A'LOMEM'                 lomem (end of program) $2000         DC    A'UNITABL'               unit table         DC    A'PROCESR'               current processor         DC    A'VERSION'               current version string         DC    A'PSLOT'                 printer slot         DC    A'CLDSTRT'               cold start flag         DC    A'I80'                   printer initialization string;;  Terminal control variables.;VERSION  DC    C'4.1D1'                 version stringCLICK    DC    I1'0'                    keyboard click flagWAITF    DC    I1'1'                    pause/wait flagCURLANG  DC    I1'2'                    currently active language #PRINTER  DC    I1'1'                    printer enabled flagPROCESR  DC    I1'0'                    current processorPSLOT    DC    I1'1'                    printer slotUNITABL  DS    14                       ProDOS unit numbers for on line callCLDSTRT  DC    I1'0'                    cold start flagI80      DC    H'89 B8 B0 CE 8D'        printer initialization string         DC    11I'0';;  General purpose variables.;TCV      DC    I1'0'                    temporary cursor variablesTCH      DC    I1'0'CTCHRS   DC    I1'0'                    count character in output to fileINFLAG   DC    I1'0'                    monitor in memory flagINPUT    DC    I1'0'                    current input and output devicesOUTPUT   DC    I1'0'EXEC     DC    I1'0'TWAIT    DS    1LINFO    DS    18                       language informationNAME1    DS    65                       file name buffersNAME2    DS    65EXECF    DS    65                       exec file buffer name save areaSAVE     DS    8                        zero page save areaIOINFO   DS    4                        I/O information bufferOPENI    DC    I1'0'                    open input file buffer refnum/address         DS    2OPENO    DC    I1'0'                    open output file buffer refnum/address         DS    2OPENE    DC    I1'0'                    open exec file buffer refnumTA       DS    1                        temporary registarsTX       DS    1TY       DS    1;;  Command Table;CMD      DCMD  ASM6502,82         DCMD  ASML,01         DCMD  ASMLG,02         DCMD  ASSEMBLE,03         DCMD  CATALOG,04         DCMD  CHANGE,14         DCMD  COPY,05         DCMD  CREATE,06         DCMD  DELETE,07         DCMD  DISABLE,08         DCMD  EDIT,09         DCMD  ENABLE,0A         DCMD  EXEC,86         DCMD  FILETYPE,15         DCMD  HELP,0B         DCMD  LINK,0C         DCMD  NEW,0D         DCMD  PREFIX,0E         DCMD  PRODOS,80         DCMD  QUIT,0F         DCMD  RENAME,10         DCMD  RUN,02         DCMD  SHOW,11         DCMD  TEXT,81         DCMD  TYPE,12         AIF   TYPE80=1,.VID1           maximize room for command table         AIF   TYPE80=2,.VID2         AIF   TYPE80=3,.AP40         DS    $15A                     STANDARD APPLE 80 COL         AGO   .DONE.VID1         DS    $141                     STANDARD VIDEX         AGO   .DONE.VID2         DS    $14B                     NO-INVERSE VIDEX         AGO   .DONE.AP40         DS    $99                      40 COL DRIVER.DONE         DC    H'FF'                    end of table marker;;  System Prefix's;UPREFIX  DFILE /UTILITIES               prefix for utilitiesLPREFIX  DFILE /ORCA/LANGUAGES          prefix for language directoryMPREFIX  DFILE /ORCA/SYSTEM             prefix for monitorSPREFIX  DFILE /LIBRARIES               prefix for subroutine libraryWPREFIX  DFILE /ORCA                    prefix for workspace;LNAME    DS    65                       language path name build area;;  Subroutines for handling O/S interupts and calls.;ORCASUBS DR    SCPOSN,90                find position of cursor         DR    SCSIZE,91                find screen size         DR    SCPUTC,92                put a character         DR    SCPUTX,93                put a character w/o advance         DR    SCPUTL,94                put a line         DR    SKEYIN,98                read a key without cursor         DR    SKEYCR,99                read a key with cursor         DR    SKEYPR,9A                check for keypress         DR    SANAME,E0                find the address of the language name!                                        table         DR    SACLNG,E1                find the current language         DR    SASLNG,E2                set the current language         DR    SAGLIN,E3                get language info         DR    SASLIN,E4                set language info         DR    SARDIR,E6                set I/O hook for re-direction         DR    SADIRC,E7                returns current I/O device         DC    3I1'0';;  ProDOS DCB's;IF_DCB   DC    I1'10'                   File info DCB         DC    A'NAME1'ACCESS   DS    1FIL_TYPE DS    1AUX_TYPE DS    2STR_TYPE DS    1USED     DS    2MOD      DS    4CREATE   DS    4OPENDCB  DC    I1'3'                    Open file DCB         DC    A'NAME1'         DS    3MARKDCB  DC    I1'2'                    Mark DCB         DS    4CLOSEDCB DC    I1'1'                    Close file DCB         DS    1RDEXDCB  DC    I1'4'                    Read one character DCB         DS    1DATA     DC    A'RDATA'         DC    I'1'         DS    2RDATA    DS    1                        character read buffer         END         APPEND OH.PAMAIN