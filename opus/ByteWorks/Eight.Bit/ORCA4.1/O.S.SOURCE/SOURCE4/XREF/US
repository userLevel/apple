         LIST  OFF         SYMBOL OFF         KEEP  USER         MCOPY /RAM/US.MACROS******************************************************************  SUSER - Assembly Language User Subroutine for Global Cross*        Reference Generator**  Copyright October 1984,1986*  By Mike Westerfield**  Inputs:*        (R0) - (TLINE) 80 character line to evaluate**  Outputs:*        (R2) - (SYMBOL) List of symbols found.  Each is 10 chars*              long, padded on the right with blanks if necessary.*        (R4) - (SYMKEY) One byte symbol keys, indicating the type*              (or existance) of symbols in the symbol table area.*              The codes are:*              0 - no more symbols*              2 - define symbol*              3 - symbol use*              4 - frequency count*        R6 - (CFLAG) Copy flag; tells if a COPY directive was found.*        R7 - (AFLAG) Append flag; tells if an APPEND directive was found.*        (R8) - (CNAME) 64 character ProDOS file name for the COPY or*              APPEND directive found.**  Notes:*        1) User routine must start at $2000, and must lie in the range*              $2000-$2FFF.*        2) Flags are 1 if true and 0 if false.*        3) CNAME does not have to be set if there was no COPY or APPEND*              directive.*        4) All characters are ASCII characters (high bit off).*        5) Input line is in ASCII characters.******************************************************************U816     START         USING USERR0       EQU   2         LDY   #79                      recover the input lineLB0      LDA   (R0),Y         JSR   SHIFT         STA   TLINE,Y         DBPL  Y,LB0         LM    (NSYM,CFLAG,AFLAG,SYMKEY),#0         MOVE  #$20,SYMBOL,#250         JSR   SCMNT                    skip comments         BCS   LB1         JSR   SGFRQ                    get opnd for frequency count         JSR   SCPAP                    do copy and append         JSR   SGLDF                    get label defs         JSR   SGLUS                    get label usesLB1      LDY   NSYM                     write terminating symbol         CPY   #25         BGE   LB2         LDA   #0         STA   SYMKEY,YLB2      LA    R2,SYMBOL                set return addresses         LA    R4,SYMKEY         LM    R6,CFLAG         LM    R7,AFLAG         LA    R8,CNAME         RTS         END******************************************************************  USER - Common Data Area******************************************************************USER     DATA;;  zero page equates;R0       GEQU  $2                       general purposeR1       GEQU  $3                        registersR2       GEQU  $4R3       GEQU  $5R4       GEQU  $6R5       GEQU  $7R6       GEQU  $8R7       GEQU  $9R8       GEQU  $AR9       GEQU  $BR10      GEQU  $CR11      GEQU  $DR12      GEQU  $ER13      GEQU  $FR14      GEQU  $10R15      GEQU  $11;;  Parameters.;TLINE    DS    80                       text lineSYMKEY   DS    26                       symbol keys:!                                             0 - no more symbols!                                             2 - define symbol!                                             3 - symbol use!                                             4 - frequency countCFLAG    DS    1                        copy file flagAFLAG    DS    1                        append file flagCNAME    DS    65                       copy or append file nameSYMBOL   DS    250                      symbols found;;  Data areas.;NSYM     DS    1                        number of symbolsSMBOL    DS    10                       work symbolSMKEY    DS    1                        work symbol key         END         APPEND US.SALID