******************************************************************  SYSTRAP - Floating Point Error Trap**  This routine intercepts and handles errors from the*  floating point routines.  It can be replaced by a user*  written error handler.**  By Mike Westerfield*  Copyright (C) June 1984, All rights reserved*  By the Byte Works, Inc.**  INPUTS:*        A - Error mask*        SYSFEM - Floating point error mask**  OUTPUTS:*        SYSFERR - error flags, may be updated******************************************************************SYSTRAP  START         USING SYSCOM         DC    R'SYSCOM'         CMP   #FERR3                   for overflow, set result to inf         BNE   TR1         PHA         LDA   #FINF         BNE   TR2TR1      CMP   #FERR4                   for underflow, set result to 0         BNE   TR3         PHA         LDA   #FZEROTR2      ASL   A         ASL   SYSS1         ROR   A         STA   SYSS1         PLATR3      AND   SYSFEM                   set the error flag         ORA   SYSFERR         STA   SYSFERR         RTS         END******************************************************************  SYSEROR - Run Time Error Handler**  By Mike Westerfield*  Copyright (C) June 1984, All rights reserved*  By the Byte Works, Inc.**  INPUTS:*        X - error number**  NOTES:*        1)  Errors are numbered from 1.******************************************************************SYSEROR  STARTCOUT     EQU   $FDED                    monitor character outputCROUT    EQU   $FD8E                    monitor linefeed         JSR   SYSERIN                  allow for user error handlers         BCC   ER0         RTSER0      JSR   CROUT                    print the standard error message         LA    WR0,ERRORS         LDY   #0ER1      DEX         BEQ   ER2         SEC         LDA   WR0         ADC   (WR0),Y         STA   WR0         BCC   ER1         INC   WR1         BNE   ER1ER2      LDA   (WR0),Y         INY         TAXER3      LDA   (WR0),Y         ORA   #$80         JSR   COUT         INY         DBNE  X,ER3         JMP   CROUTERRORS   DW    'Evaluation Stack Overflow'         DW    ' '         DW    ' '         DW    'Software Interupt'         DW    'Invalid Operation'         DW    'Division by Zero'         DW    'Overflow'         DW    'Underflow'         DW    'Inexact'         END******************************************************************  SYSERIN - Error Interupt Dummy Routine**  By Mike Westerfield*  Copyright (C) June 1984, All rights reserved*  By the Byte Works, Inc.**  OUTPUTS:*        C - clear******************************************************************SYSERIN  START         CLC         RTS         END******************************************************************  SYSCOM - common area for system routines**  By Mike Westerfield*  Copyright (C) June 1984, All rights reserved*  By the Byte Works, Inc.******************************************************************SYSCOM   DATA;;  common use work areas;SYSWORK  ANOPTX1      DS    10TX2      DS    10TX3      DS    10TX4      DS    10;;  constants;SYSFEM   DC    H'FF'                    error masks;;  powers of two table;PWR      ANOPONE      DC    H'00 7FFF 800000 00000000'       1E0         DC    I'0'TEN      DC    H'00 8002 A00000 00000000'       1E1         DC    I'1'         DC    H'00 8005 C80000 00000000'       1E2         DC    I'2'         DC    H'00 800C 9C4000 00000000'       1E4         DC    I'4'         DC    H'00 8019 BEBC20 00000000'       1E8         DC    I'8'         DC    H'00 8034 8E1BC9 BF040000'       1E16         DC    I'16'E32      DC    H'00 8069 9DC5AD A82B70B6'       1E32         DC    I'32'         DC    H'00 80D3 C2781F 49FFCFA7'       1E64         DC    I'64'         DC    H'00 81A8 93BA47 C980E98D'       1E128         DC    I'128'E256     DC    H'00 8351 AA7EEB FB9DF9DF'       1E256         DC    I'256'         END