 MACRO&LAB DCI &STRING AIF L:&STRING=1,.L1 LCLC &CHAR&CHAR AMID '&STRING',L:&STRING,1&STRING AMID '&STRING',1,L:&STRING-1&LAB DC C'&STRING' MSB ON DC C'&CHAR' MSB OFF MEXIT.L1 MSB ON&LAB DC C'&STRING' MSB OFF MEND MACRO&LAB BLE &ADR BLT &ADR BEQ &ADR MEND MACRO&LAB LA &AD1,&AD2 LCLA &LP&LAB LDA #<&AD2&LP SETA C:&AD1.C2 STA &AD1(&LP)&LP SETA &LP-1 AIF &LP>0,.C2 AIF C:&AD1<>1,.C2A AIF &AD2/256=&AD2-&AD2/256,.C2B.C2A LDA #>&AD2.C2B&LP SETA C:&AD1.C3 STA &AD1(&LP).+1&LP SETA &LP-1 AIF &LP>0,.C3 MEND MACRO&LAB PROMPT &CHAR LDA &CHAR STA $33 MEND MACRO&LAB INC2 &ADR&LAB INC &ADR BNE SYSI&SYSCNT INC &ADR+1SYSI&SYSCNT ANOP MEND MACRO&LAB DEC2 &ADR,&R LCLC &A&A SETC 'A' AIF C:&R=0,.D1&A SETC &R.D1&LAB LD&A &ADR BNE SYSA&SYSCNT DEC &ADR+1SYSA&SYSCNT DEC &ADR MEND MACRO&LAB CMP2 &AD1,&AD2,&R LCLC &X LCLC &IM LCLB &IM1 LCLB &IM2&X SETC A AIF C:&R=0,.C1&X SETC &R.C1&IM AMID '&AD1',1,1 AIF '&IM'<>'#',.C2&IM1 SETB 1&AD1 AMID '&AD1',2,L:&AD1-1.C2&IM AMID '&AD2',1,1 AIF '&IM'<>'#',.C3&IM2 SETB 1&AD2 AMID '&AD2',2,L:&AD2-1.C3 AIF &IM1,.C4&LAB LD&X 1+&AD1 AGO .C5.C4&LAB LD&X #>&AD1.C5 AIF &IM2,.C6 CP&X 1+&AD2 AGO .C7.C6 CP&X #>&AD2.C7 BNE SYSA&SYSCNT AIF &IM1,.C8 LD&X &AD1 AGO .C9.C8 LD&X #<&AD1.C9 AIF &IM2,.C10 CP&X &AD2 AGO .C11.C10 CP&X #<&AD2.C11SYSA&SYSCNT ANOP MEND MACRO&LAB MOVE &AD1,&AD2,&L,&R LCLA &LP LCLB &MAX LCLB &IM LCLC &IMC LCLC &X&IMC AMID &AD1,1,1 AIF '&IMC'<>'#',.C0&IM SETB 1.C0 AIF C:&L=0,.C3&X SETC X AIF C:&R=0,.C1&X SETC &R.C1&IMC AMID &L,1,1 AIF '&IMC'<>'#',.C1C&IMC AMID &L,2,L:&L-1 AIF &IMC<>0,.C1C&IMC AMID '&IMC',2,1 AIF '&IMC'=':',.C1C&MAX SETB 1.C1C&LAB LD&X &L AIF &IM,.C1A AIF &MAX,.C1DSYSA&SYSCNT LDA &AD1-1,&X AGO .C1B.C1DSYSA&SYSCNT LDA &AD1,&X AGO .C1B.C1A LDA &AD1SYSA&SYSCNT ANOP.C1B&LP SETA C:&AD2.C2 AIF &MAX,.C2A STA &AD2(&LP).-1,&X AGO .C2B.C2A STA &AD2(&LP),&X.C2B&LP SETA &LP-1 AIF &LP>0,.C2 DE&X BNE SYSA&SYSCNT MEXIT.C3 AIF &IM,.C3A&LAB LDA 1+&AD1 AGO .C3B.C3A&LAB LDA &AD1.C3B&LP SETA C:&AD2.C4 STA 1+&AD2(&LP)&LP SETA &LP-1 AIF &LP>0,.C4 AIF &IM,.C4A LDA &AD1.C4A&LP SETA C:&AD2.C5 STA &AD2(&LP)&LP SETA &LP-1 AIF &LP>0,.C5 MEND MACRO&LAB JCS &BP&LAB BCC *+5 JMP &BP MEND MACRO&LAB JEQ &BP&LAB BNE *+5 JMP &BP MEND MACRO&LAB JMI &BP&LAB BPL *+5 JMP &BP MEND MACRO&LAB JNE &BP&LAB BEQ *+5 JMP &BP MEND MACRO&LAB JLT &BP&LAB BGE *+5 JMP &BP MEND MACRO&LAB COUT &R LCLC &IM AIF C:&R=0,.C2&IM AMID &R,1,1 AIF '&IM'='#',.C0 AIF '&R'='X',.C1 AIF '&R'='Y',.C1 AIF '&R'='A',.C2.C0&LAB LDA &R AGO .C3.C1&LAB T&R.A AGO .C3.C2&LAB ANOP.C3 JSR SYSCOUT MEND MACRO&LAB PRINT &CHRS AIF C:&CHRS=0,.L1&LAB JSR SRITE DC H'80',I1'L:SL&SYSCNT'SL&SYSCNT DC C'&CHRS' MEXIT.L1&LAB LDA #$0D JSR SYSCOUT MEND MACRO&LAB PRINT2 &CHRS&LAB JSR SRITE DC I1'0,L:SL&SYSCNT'SL&SYSCNT DC C'&CHRS' MEND MACRO&LAB LM &AD1,&AD2,&R LCLC &A LCLA &LP&A SETC A AIF C:&R=0,.LB1&A SETC &R.LB1&LAB LD&A &AD2&LP SETA C:&AD1.LB2 ST&A &AD1(&LP)&LP SETA &LP-1 AIF &LP<>0,.LB2 MEND MACRO&LAB ADD2 &AD1,&AD2,&AD3 LCLA &CAD3&CAD3 SETA C:&AD3 LCLB &IM LCLC &TC&LAB CLC LDA &AD1&TC AMID '&AD2',1,1 AIF '&TC'='#',.IM ADC &AD2 AGO .SV.IM&IM SETB 1&AD2 AMID '&AD2',2,L:&AD2-1 ADC #<&AD2.SV AIF C:&AD3>0,.SV1 LCLC &AD3&AD3 SETC &AD1.SV1 LCLA &LP&LP SETA C:&AD3.SV2 STA &AD3(&LP)&LP SETA &LP-1 AIF &LP>0,.SV2 AIF &IM,.HB LDA &AD1+1 ADC &AD2+1 AGO .HB4.HB AIF &AD2/256<>0.OR.&CAD3>0,.HB3 BCC SL&SYSCNT INC &AD1+1SL&SYSCNT ANOP MEXIT.HB3 LDA &AD1+1 ADC #>&AD2.HB4&LP SETA C:&AD3.SV5 STA &AD3(&LP).+1&LP SETA &LP-1 AIF &LP>0,.SV5 MEND MACRO&LAB PUTREGS&LAB STA AREG STX XREG STY YREG PHP PLA STA PREG TSX STX SREG MEND MACRO&LAB GETREGS&LAB LDX SREG TXS LDA PREG PHA LDY YREG LDX XREG LDA AREG PLP MEND MACRO&LAB CLOSE &DCB&LAB JSR $BF00 DC H"CC" DC I"&DCB" MEND MACRO&LAB GET_INFO &DCB&LAB JSR $BF00 DC H"C4" DC I"&DCB" MEND MACRO&LAB GET_PREFIX &DCB&LAB JSR $BF00 DC H"C7" DC I"&DCB" MEND MACRO&LAB OPEN &DCB&LAB JSR $BF00 DC H"C8" DC I"&DCB" MEND MACRO&LAB READ &DCB&LAB JSR $BF00 DC H"CA" DC I"&DCB" MEND MACRO&LAB READ_BLK &DCB&LAB JSR $BF00 DC H"80" DC I"&DCB" MEND MACRO&LAB SET_PREFIX &DCB&LAB JSR $BF00 DC H"C6" DC I"&DCB" MEND MACRO&LAB HOME&LAB LDA   #$0C JSR SYSCOUT MEND MACRO&LAB REDIRECT &DCB&LAB JSR SAVEC JSR $FD DC H'E6' DC A'&DCB' JSR RESTC MEND MACRO&LAB RDKEY &NOCURSOR&LAB JSR SAVEC JSR $FD AIF C:&NOCURSOR=0,.A DC H"98" AGO .B.A DC H"99".B DS 2 JSR RESTC MEND MACRO&LAB GOTOXY &X,&Y&LAB LDA #$1E JSR SYSCOUT CLC LDA &X ADC #32 JSR SYSCOUT CLC LDA &Y ADC #32 JSR SYSCOUT MEND MACRO&LAB CLEOL&LAB LDA #$1D JSR   SYSCOUT MEND MACRO&LAB RAM &READ,&WRITE,&BANK AIF C:&READ>0,.L1 LCLC &READ&READ SETC RAM.L1 AIF C:&WRITE>0,.L2 LCLC &WRITE&WRITE SETC ON.L2 AIF C:&BANK>0,.L3 LCLC &BANK&BANK SETC 1.L3 AIF '&READ'='RAM',.L5 AIF '&WRITE'='ON',.L4&LAB LDA $C08A-(&BANK-1)*8 MEXIT.L4&LAB LDA $C089-(&BANK-1)*8 LDA $C089-(&BANK-1)*8 MEXIT.L5 AIF '&WRITE'='ON',.L6&LAB LDA $C088-(&BANK-1)*8 MEXIT.L6&LAB LDA $C08B-(&BANK-1)*8 LDA $C08B-(&BANK-1)*8 MEND