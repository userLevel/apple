 MACRO&lab _OPEN &params&lab jsl $E100A8 dc i2"$10" dc i4"&params" MEND MACRO&lab _READ &params&lab jsl $E100A8 dc i2"$12" dc i4"&params" MEND MACRO&lab _CLOSE &params&lab jsl $E100A8 dc i2"$14" dc i4"&params" MEND MACRO&lab _QUIT &params&lab jsl $E100A8 dc i2"$29" dc i4"&params" MEND MACRO&lab _ERROR &params&lab jsl $E100A8 dc i2"$0105" dc i4"&params" MEND MACRO&lab pushlong &addr,&offset&lab ANOP LCLC &C LCLC &REST&C AMID &addr,1,1 AIF "&C"="#",.immediate AIF "&C"="[",.zeropage AIF C:&offset=0,.nooffset AIF "&offset"="s",.stack pushword &addr+2,&offset pushword &addr,&offset MEXIT.nooffset pushword &addr+2 pushword &addr MEXIT.immediate&REST AMID &addr,2,L:&addr-1 dc I1'$F4',I2'(&REST)|-16' dc I1'$F4',I2'&REST' MEXIT.stack pushword &addr+2,s pushword &addr+2,s MEXIT.zeropage ldy #&offset+2 pushword &addr,y ldy #&offset pushword &addr,y MEND MACRO&lab pushword &SYSOPR&lab ANOP AIF C:&SYSOPR=0,.b LCLC &C&C AMID "&SYSOPR",1,1 AIF ("&C"="#").AND.(S:LONGA),.immediate lda &SYSOPR pha MEXIT.b pha MEXIT.immediate LCLC &REST LCLA &BL&BL ASEARCH "&SYSOPR"," ",1 AIF &BL>0,.a&BL SETA L:&SYSOPR+1.a&REST AMID "&SYSOPR",2,&BL-2 dc I1'$F4',I2'&REST' MEND MACRO&lab str &string&lab dc i1'L:&string',C'&string' MEND MACRO&lab dp &pointer&lab dc i4'&pointer' MEND MACRO&lab longm&lab ANOP rep #%00100000 longa on MEND MACRO&lab shortm&lab ANOP sep #%00100000 longa off MEND MACRO&lab writestr &addr&lab ANOP AIF C:&addr=0,.c lclc &char&char amid &addr,1,1 AIF "&char"="#",.a pea &addr|-16 pea &addr ago .b.a lclc &str&str amid &addr,3,L:&addr-3 bra ~b&SYSCNT~a&SYSCNT dc i1'L:&str',C'&str'~b&SYSCNT pea ~a&SYSCNT|-16 pea ~a&SYSCNT.b ldx #$1C0C jsl $E10000 MEXIT.c phy pha AGO .b MEND MACRO&lab writeln &addr&lab ANOP AIF C:&addr=0,.c lclc &char&char amid &addr,1,1 AIF "&char"="#",.a pea &addr|-16 pea &addr ago .b.a lclc &str&str amid &addr,3,L:&addr-3 bra ~b&SYSCNT~a&SYSCNT dc I1'L:&str',C'&str'~b&SYSCNT pea ~a&SYSCNT|-16 pea ~a&SYSCNT.b ldx #$1A0C~c&SYSCNT jsl $E10000 MEXIT.c pea +(~c&SYSCNT+1)|-16 pea ~c&SYSCNT+1 AGO .b MEND MACRO&lab _Long2Hex&lab ldx #$230B jsl $E10000 MEND MACRO&lab inc4 &a1&lab ANOP inc &a1 bne ~a&SYSCNT inc &a1+2~a&SYSCNT ANOP MEND MACRO&lab InitWildcardGS &params&lab jsl $E100A8 dc i2"$0149" dc i4"&params" MEND MACRO&lab NextWildcardGS &params&lab jsl $E100A8 dc i2"$014A" dc i4"&params" MEND MACRO&lab _IMStartUp&lab ldx #$020B jsl $E10000 MEND MACRO&lab _IMShutDown&lab ldx #$030B jsl $E10000 MEND MACRO&lab _GetInGlobals&lab ldx #$0C0C jsl $E10000 MEND MACRO&lab _SetInGlobals&lab ldx #$090C jsl $E10000 MEND MACRO&lab _Int2Hex&lab ldx #$220B jsl $E10000 MEND MACRO&lab _GET_FILE_INFO &params&lab jsl $E100A8 dc i2"6" dc i4"&params" MEND MACRO&lab _Int2Dec&lab ldx #$260B jsl $E10000 MEND MACRO&lab long&lab ANOP rep #%00110000 longa on longi on MEND MACRO&lab shortx&lab ANOP sep #%00010000 longi off MEND MACRO&lab _ReadChar&lab ldx #$220C jsl $E10000 MEND MACRO&lab _SET_MARK &params&lab jsl $E100A8 dc i2"$16" dc i4"&params" MEND MACRO&lab _GET_EOF &params&lab jsl $E100A8 dc i2"$19" dc i4"&params" MEND MACRO&lab _Dec2Int&lab ldx #$280B jsl $E10000 MEND MACRO&lab _Dec2Long&lab ldx #$290B jsl $E10000 MEND MACRO&lab _Hex2Long&lab ldx #$250B jsl $E10000 MEND MACRO&lab pulllong &addr1,&addr2&lab ANOP AIF C:&addr1=0,.a AIF C:&addr2=0,.b LCLC &C&C AMID &addr1,1,1 AIF "&C"="[",.zeropage pullword &addr1 sta &addr2 pullword &addr1+2 sta &addr2+2 MEXIT.a pullword pullword MEXIT.b pullword &addr1 pullword &addr1+2 MEXIT.zeropage ldy #&addr2 pullword &addr1,y ldy #&addr2+2 pullword &addr1,y MEND MACRO&lab pullword &SYSOPR&lab ANOP pla AIF C:&SYSOPR=0,.end sta &SYSOPR.end MEND MACRO&lab _OpenGS &params&lab jsl $E100A8 dc i2"$2010" dc i4"&params" MEND MACRO&LAB CONSOLEOUT &DCB&LAB ~SETM JSL $E100A8 DC I2'$011A' DC I4'&DCB' ~RESTM MEND MACRO&LAB ~SETM&LAB ANOP AIF C:&~LA,.B GBLB &~LA GBLB &~LI.B&~LA SETB S:LONGA&~LI SETB S:LONGI AIF S:LONGA.AND.S:LONGI,.A REP #32*(.NOT.&~LA)+16*(.NOT.&~LI) LONGA ON LONGI ON.A MEND MACRO&LAB ~RESTM&LAB ANOP AIF (&~LA+&~LI)=2,.I SEP #32*(.NOT.&~LA)+16*(.NOT.&~LI) AIF &~LA,.H LONGA OFF.H AIF &~LI,.I LONGI OFF.I MEND MACRO&lab procname &pname&lab anop aif .NOT.&Debug,.NoProcName brl ~a&SYSCNT dc i'$7771' str '&pname'~a&SYSCNT anop.NoProcName MEND macro&l ~Long2Dec &p1,&p2,&p3,&p4&l ph4 &p1 ph4 &p2 ph2 &p3 ph2 &p4 ldx #$270B jsl $E10000 mend macro&l ~Long2Hex &p1,&p2,&p3&l ph4 &p1 ph4 &p2 ph2 &p3 ldx #$230B jsl $E10000 mend macro&l ~WriteCString &p1&l ph4 &p1 ldx #$200C jsl $E10000 mend macro&l ph2 &n1 aif "&n1"="*",.f lclc &c&l anop&c amid &n1,1,1 aif "&c"="#",.d aif s:longa=1,.a rep #%00100000.a aif "&c"<>"{",.b&c amid &n1,l:&n1,1 aif "&c"<>"}",.g&n1 amid &n1,2,l:&n1-2 lda (&n1) pha ago .e.b aif "&c"="<",.c lda &n1 pha ago .e.c&n1 amid &n1,2,l:&n1-1 pei &n1 ago .e.d&n1 amid &n1,2,l:&n1-1 pea &n1 ago .f.e aif s:longa=1,.f sep #%00100000.f mexit.g mnote "Missing closing '}'",16 mend macro&l ph4 &n1 aif "&n1"="*",.f lclc &c&l anop&c amid &n1,1,1 aif "&c"="#",.d aif s:longa=1,.a rep #%00100000.a aif "&c"<>"{",.b&c amid &n1,l:&n1,1 aif "&c"<>"}",.g&n1 amid &n1,2,l:&n1-2 ldy #2 lda (&n1),y pha lda (&n1) pha ago .e.b aif "&c"<>"[",.c ldy #2 lda &n1,y pha lda &n1 pha ago .e.c aif "&c"<>"<",.c1&n1 amid &n1,2,l:&n1-1 pei &n1+2 pei &n1 ago .e.c1 lda &n1+2 pha lda &n1 pha ago .e.d&n1 amid &n1,2,l:&n1-1 pea +(&n1)|-16 pea &n1 ago .f.e aif s:longa=1,.f sep #%00100000.f mexit.g mnote "Missing closing '}'",16 mend