 MACRO&lab pulllong &addr1,&addr2&lab ANOP AIF C:&addr1=0,.a AIF C:&addr2=0,.b LCLC &C&C AMID &addr1,1,1 AIF "&C"="[",.zeropage pullword &addr1 sta &addr2 pullword &addr1+2 sta &addr2+2 MEXIT.a pullword pullword MEXIT.b pullword &addr1 pullword &addr1+2 MEXIT.zeropage ldy #&addr2 pullword &addr1,y ldy #&addr2+2 pullword &addr1,y MEND MACRO&lab pullword &SYSOPR&lab ANOP pla AIF C:&SYSOPR=0,.end sta &SYSOPR.end MEND MACRO&lab pushlong &addr,&offset&lab ANOP LCLC &C LCLC &REST&C AMID &addr,1,1 AIF "&C"="#",.immediate AIF "&C"="[",.zeropage AIF C:&offset=0,.nooffset AIF "&offset"="s",.stack pushword &addr+2,&offset pushword &addr,&offset MEXIT.nooffset pushword &addr+2 pushword &addr MEXIT.immediate&REST AMID &addr,2,L:&addr-1 dc I1'$F4',I2'(&REST)|-16' dc I1'$F4',I2'&REST' MEXIT.stack pushword &addr+2,s pushword &addr+2,s MEXIT.zeropage ldy #&offset+2 pushword &addr,y ldy #&offset pushword &addr,y MEND MACRO&lab pushword &SYSOPR&lab ANOP AIF C:&SYSOPR=0,.b LCLC &C&C AMID "&SYSOPR",1,1 AIF ("&C"="#").AND.(S:LONGA),.immediate lda &SYSOPR pha MEXIT.b pha MEXIT.immediate LCLC &REST LCLA &BL&BL ASEARCH "&SYSOPR"," ",1 AIF &BL>0,.a&BL SETA L:&SYSOPR+1.a&REST AMID "&SYSOPR",2,&BL-2 dc I1'$F4',I2'&REST' MEND MACRO&lab str &string&lab dc i1'L:&string',C'&string' MEND MACRO&lab writestr &addr&lab ANOP AIF C:&addr=0,.c lclc &char&char amid &addr,1,1 AIF "&char"="#",.a pea &addr|-16 pea &addr ago .b.a lclc &str&str amid &addr,3,L:&addr-3 bra ~b&SYSCNT~a&SYSCNT dc i1'L:&str',C'&str'~b&SYSCNT pea ~a&SYSCNT|-16 pea ~a&SYSCNT.b ldx #$1C0C jsl $E10000 MEXIT.c phy pha AGO .b MEND MACRO&lab writeln &addr&lab ANOP AIF C:&addr=0,.c lclc &char&char amid &addr,1,1 AIF "&char"="#",.a pea &addr|-16 pea &addr ago .b.a lclc &str&str amid &addr,3,L:&addr-3 bra ~b&SYSCNT~a&SYSCNT dc I1'L:&str',C'&str'~b&SYSCNT pea ~a&SYSCNT|-16 pea ~a&SYSCNT.b ldx #$1A0C~c&SYSCNT jsl $E10000 MEXIT.c pea +(~c&SYSCNT+1)|-16 pea ~c&SYSCNT+1 AGO .b MEND MACRO&lab _CompactMem&lab ldx #$1F02 jsl $E10000 MEND MACRO&lab _FindHandle&lab ldx #$1A02 jsl $E10000 MEND MACRO&lab _PurgeHandle&lab ldx #$1202 jsl $E10000 MEND MACRO&lab _Int2Hex&lab ldx #$220B jsl $E10000 MEND MACRO&lab _QUIT &params&lab jsl $E100A8 dc i2"$29" dc i4"&params" MEND MACRO&lab _Long2Hex&lab ldx #$230B jsl $E10000 MEND MACRO&lab add4 &a1,&a2,&a3&lab ANOP LCLC &C1 LCLC &C2 LCLC &REST1 LCLC &REST2&C2 AMID &a2,1,1&REST2 AMID &a2,2,L:&a2-1 AIF C:&a1=0,.a&C1 AMID &a1,1,1&REST1 AMID &a1,2,L:&a1-1 lda &a1.a clc adc &a2 sta &a3 AIF C:&a1>0,.b lda #0 AGO .d.b AIF "&C1"="#",.c lda &a1+2 AGO .d.c lda #^&REST1.d AIF "&C2"="#",.e adc &a2+2 AGO .f.e adc #^&REST2.f sta &a3+2 MEND MACRO&lab _LGetPathname&lab ldx #$1111 jsl $E10000 MEND MACRO&lab _WriteCString&lab ldx #$200C jsl $E10000 MEND MACRO&lab longm&lab ANOP rep #%00100000 longa on MEND MACRO&lab shortm&lab ANOP sep #%00100000 longa off MEND MACRO&lab _Int2Dec&lab ldx #$260B jsl $E10000 MEND MACRO&lab long&lab ANOP rep #%00110000 longa on longi on MEND MACRO&lab short&lab ANOP sep #%00110000 longa off longi off MEND MACRO&lab writech &SYSOPR&lab ANOP AIF C:&SYSOPR=0,.a lda &SYSOPR.a pha ldx #$180C jsl $E10000 MEND MACRO&lab _WRITE_CONSOLE &params&lab jsl $E100A8 dc i2"$011A" dc i4"&params" MEND